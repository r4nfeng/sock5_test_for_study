<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOCKS5 åè®®åˆ†æå·¥å…·</title>
  <style>
    /* å…¨å±€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    #app {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* æ ‡é¢˜æ ·å¼ */
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .header .subtitle {
      font-size: 16px;
      opacity: 0.9;
    }

    .header .tips {
      margin-top: 15px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      font-size: 14px;
    }

    /* å¡ç‰‡å®¹å™¨ */
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    /* å¡ç‰‡æ ·å¼ */
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 20px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    /* è¡¨å•æ ·å¼ */
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #555;
      font-weight: bold;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    /* æŒ‰é’®æ ·å¼ */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-success {
      background: #48bb78;
      color: white;
    }

    .btn-success:hover {
      background: #38a169;
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .btn-danger:hover {
      background: #e53e3e;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ç»ˆç«¯æ ·å¼ */
    .terminal {
      background: #1a1a1a;
      color: #00ff00;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      height: 400px;
      overflow-y: auto;
      line-height: 1.6;
    }

    .terminal-line {
      margin: 2px 0;
    }

    .terminal-line.error {
      color: #ff6b6b;
    }

    .terminal-line.success {
      color: #51cf66;
    }

    .terminal-line.info {
      color: #74c0fc;
    }

    .terminal-line.warning {
      color: #ffd43b;
    }

    /* åè®®æ­¥éª¤æ ·å¼ */
    .protocol-steps {
      list-style: none;
      padding: 0;
    }

    .protocol-step {
      padding: 15px;
      margin-bottom: 12px;
      border-radius: 8px;
      border-left: 4px solid #ddd;
      background: #f7f7f7;
      transition: all 0.3s;
    }

    .protocol-step.active {
      border-left-color: #667eea;
      background: #eef2ff;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
    }

    .protocol-step.completed {
      border-left-color: #48bb78;
      background: #f0fff4;
    }

    .protocol-step.failed {
      border-left-color: #f56565;
      background: #fff5f5;
    }

    .protocol-step h3 {
      font-size: 16px;
      margin-bottom: 8px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .protocol-step p {
      font-size: 13px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 8px;
    }

    /* æ•°æ®åŒ…æ ·å¼ */
    .packet {
      background: white;
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
      border: 1px solid #e0e0e0;
    }

    .packet-header {
      font-weight: bold;
      color: #667eea;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .packet-data {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      word-break: break-all;
      line-height: 1.8;
    }

    .packet-fields {
      margin-top: 10px;
      font-size: 12px;
    }

    .packet-field {
      display: flex;
      padding: 4px 0;
      border-bottom: 1px solid #eee;
    }

    .packet-field:last-child {
      border-bottom: none;
    }

    .field-offset {
      width: 80px;
      color: #999;
      font-family: 'Courier New', monospace;
    }

    .field-name {
      width: 120px;
      color: #667eea;
      font-weight: bold;
    }

    .field-value {
      color: #333;
      font-family: 'Courier New', monospace;
    }

    .field-desc {
      color: #666;
      margin-left: 10px;
    }

    /* Wiresharkæç¤º */
    .wireshark-tip {
      background: #e3f2fd;
      border: 1px solid #2196f3;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }

    .wireshark-tip h3 {
      color: #1976d2;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .wireshark-tip ol {
      margin-left: 20px;
      color: #555;
      line-height: 1.8;
    }

    .wireshark-tip li {
      margin: 5px 0;
    }

    .wireshark-tip code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      color: #c7254e;
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="header">
      <h1>ğŸ” SOCKS5 åè®®åˆ†æå·¥å…·</h1>
      <p class="subtitle">å®æ—¶ç›‘æ§SOCKS5åè®®å®ç°è¿‡ç¨‹ | é…åˆWiresharkæŠ“åŒ…åˆ†æ</p>
      <div class="tips">
        ğŸ’¡ æç¤ºï¼šå¯åŠ¨SOCKS5æœåŠ¡å™¨åï¼Œä½¿ç”¨æœ¬å·¥å…·è§¦å‘è¿æ¥ï¼ŒåŒæ—¶åœ¨Wiresharkä¸­æŠ“åŒ…æŸ¥çœ‹è¯¦ç»†æ•°æ®
      </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="container">
      <!-- å·¦ä¾§ï¼šè¿æ¥é…ç½®å’Œæµ‹è¯• -->
      <div class="card">
        <h2>âš™ï¸ è¿æ¥é…ç½®</h2>

        <!-- SOCKS5æœåŠ¡å™¨é…ç½® -->
        <div class="form-group">
          <label>SOCKS5 æœåŠ¡å™¨åœ°å€ï¼š</label>
          <input type="text" v-model="config.host" placeholder="ä¾‹å¦‚: 127.0.0.1">
        </div>

        <div class="form-group">
          <label>ç«¯å£ï¼š</label>
          <input type="number" v-model.number="config.port" placeholder="ä¾‹å¦‚: 1080">
        </div>

        <div class="form-group">
          <label>ç”¨æˆ·åï¼š</label>
          <input type="text" v-model="config.username" placeholder="ä¾‹å¦‚: testuser">
        </div>

        <div class="form-group">
          <label>å¯†ç ï¼š</label>
          <input type="password" v-model="config.password" placeholder="ä¾‹å¦‚: testpass">
        </div>

        <div class="form-group">
          <label>ç›®æ ‡åœ°å€ï¼š</label>
          <input type="text" v-model="config.target" placeholder="ä¾‹å¦‚: www.example.com">
        </div>

        <div class="form-group">
          <label>ç›®æ ‡ç«¯å£ï¼š</label>
          <input type="number" v-model.number="config.targetPort" placeholder="ä¾‹å¦‚: 80">
        </div>

        <div style="margin-top: 20px;">
          <button class="btn btn-primary" @click="startTest" :disabled="testing">
            {{ testing ? 'æµ‹è¯•ä¸­...' : 'ğŸš€ å¼€å§‹æµ‹è¯•è¿æ¥' }}
          </button>
          <button class="btn btn-danger" @click="clearTerminal" style="margin-left: 10px;">
            ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—
          </button>
        </div>

        <!-- ç»ˆç«¯è¾“å‡º -->
        <div class="terminal" ref="terminal" style="margin-top: 20px;">
          <div
            v-for="(line, index) in terminalLines"
            :key="index"
            class="terminal-line"
            :class="line.type"
          >
            <span v-if="line.timestamp">[{{ line.timestamp }}]</span> {{ line.text }}
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šåè®®è¿‡ç¨‹ -->
      <div class="card">
        <h2>ğŸ“‹ SOCKS5 åè®®è¿‡ç¨‹</h2>

        <ul class="protocol-steps">
          <!-- æ­¥éª¤1ï¼šæ¡æ‰‹ -->
          <li
            class="protocol-step"
            :class="getStepClass(0)"
          >
            <h3>æ­¥éª¤ 1: æ¡æ‰‹ (Handshake)</h3>
            <p>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ”¯æŒçš„è®¤è¯æ–¹æ³•åˆ—è¡¨ï¼ŒæœåŠ¡å™¨é€‰æ‹©å¹¶å“åº”è®¤è¯æ–¹å¼ã€‚</p>

            <div v-if="currentStep >= 0" class="packet">
              <div class="packet-header">ğŸ“¤ å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ï¼šæ¡æ‰‹è¯·æ±‚</div>
              <div class="packet-data">05 02 00 02</div>
              <div class="packet-fields">
                <div class="packet-field">
                  <span class="field-offset">0</span>
                  <span class="field-name">VER</span>
                  <span class="field-value">0x05</span>
                  <span class="field-desc">SOCKS5ç‰ˆæœ¬å·</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">1</span>
                  <span class="field-name">NMETHODS</span>
                  <span class="field-value">0x02</span>
                  <span class="field-desc">æ”¯æŒçš„è®¤è¯æ–¹æ³•æ•°é‡</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">2</span>
                  <span class="field-name">METHODS[0]</span>
                  <span class="field-value">0x00</span>
                  <span class="field-desc">æ— éœ€è®¤è¯</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">3</span>
                  <span class="field-name">METHODS[1]</span>
                  <span class="field-value">0x02</span>
                  <span class="field-desc">ç”¨æˆ·å/å¯†ç è®¤è¯</span>
                </div>
              </div>
            </div>

            <div v-if="currentStep >= 0 && !steps[0].failed" class="packet" style="margin-top: 8px;">
              <div class="packet-header">ğŸ“¥ æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ï¼šæ–¹æ³•é€‰æ‹©</div>
              <div class="packet-data">05 02</div>
              <div class="packet-fields">
                <div class="packet-field">
                  <span class="field-offset">0</span>
                  <span class="field-name">VER</span>
                  <span class="field-value">0x05</span>
                  <span class="field-desc">SOCKS5ç‰ˆæœ¬å·</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">1</span>
                  <span class="field-name">METHOD</span>
                  <span class="field-value">0x02</span>
                  <span class="field-desc">é€‰æ‹©ç”¨æˆ·å/å¯†ç è®¤è¯</span>
                </div>
              </div>
            </div>
          </li>

          <!-- æ­¥éª¤2ï¼šè®¤è¯ -->
          <li
            class="protocol-step"
            :class="getStepClass(1)"
          >
            <h3>æ­¥éª¤ 2: è®¤è¯ (Authentication)</h3>
            <p>å®¢æˆ·ç«¯å‘é€ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ï¼ŒæœåŠ¡å™¨è¿”å›è®¤è¯ç»“æœã€‚</p>

            <div v-if="currentStep >= 1" class="packet">
              <div class="packet-header">ğŸ“¤ å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ï¼šç”¨æˆ·åå¯†ç </div>
              <div class="packet-data">{{ formatAuthPacket() }}</div>
              <div class="packet-fields">
                <div class="packet-field">
                  <span class="field-offset">0</span>
                  <span class="field-name">VERSION</span>
                  <span class="field-value">0x01</span>
                  <span class="field-desc">è®¤è¯å­åå•†ç‰ˆæœ¬</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">1</span>
                  <span class="field-name">ULEN</span>
                  <span class="field-value">0x{{ config.username.length.toString(16).toUpperCase() }}</span>
                  <span class="field-desc">ç”¨æˆ·åé•¿åº¦</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">2</span>
                  <span class="field-name">UNAME</span>
                  <span class="field-value">{{ config.username }}</span>
                  <span class="field-desc">ç”¨æˆ·å</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">2+ULEN</span>
                  <span class="field-name">PLEN</span>
                  <span class="field-value">0x{{ config.password.length.toString(16).toUpperCase() }}</span>
                  <span class="field-desc">å¯†ç é•¿åº¦</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">3+ULEN</span>
                  <span class="field-name">PASSWD</span>
                  <span class="field-value">******</span>
                  <span class="field-desc">å¯†ç </span>
                </div>
              </div>
            </div>

            <div v-if="currentStep >= 1 && !steps[1].failed" class="packet" style="margin-top: 8px;">
              <div class="packet-header">ğŸ“¥ æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ï¼šè®¤è¯ç»“æœ</div>
              <div class="packet-data">01 00</div>
              <div class="packet-fields">
                <div class="packet-field">
                  <span class="field-offset">0</span>
                  <span class="field-name">VERSION</span>
                  <span class="field-value">0x01</span>
                  <span class="field-desc">è®¤è¯å­åå•†ç‰ˆæœ¬</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">1</span>
                  <span class="field-name">STATUS</span>
                  <span class="field-value">0x00</span>
                  <span class="field-desc">è®¤è¯æˆåŠŸ</span>
                </div>
              </div>
            </div>

            <div v-if="currentStep >= 1 && steps[1].failed" class="packet" style="margin-top: 8px; background: #ffebee;">
              <div class="packet-header" style="color: #f56565;">âŒ è®¤è¯å¤±è´¥</div>
              <div class="packet-data">01 01</div>
              <div class="packet-fields">
                <div class="packet-field">
                  <span class="field-offset">1</span>
                  <span class="field-name">STATUS</span>
                  <span class="field-value">0x01</span>
                  <span class="field-desc">è®¤è¯å¤±è´¥ï¼ˆç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼‰</span>
                </div>
              </div>
            </div>
          </li>

          <!-- æ­¥éª¤3ï¼šè¯·æ±‚ -->
          <li
            class="protocol-step"
            :class="getStepClass(2)"
          >
            <h3>æ­¥éª¤ 3: è¿æ¥è¯·æ±‚ (Request)</h3>
            <p>å®¢æˆ·ç«¯å‘é€CONNECTå‘½ä»¤ï¼Œè¯·æ±‚è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚</p>

            <div v-if="currentStep >= 2" class="packet">
              <div class="packet-header">ğŸ“¤ å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ï¼šCONNECTè¯·æ±‚</div>
              <div class="packet-data">{{ formatRequestPacket() }}</div>
              <div class="packet-fields">
                <div class="packet-field">
                  <span class="field-offset">0</span>
                  <span class="field-name">VER</span>
                  <span class="field-value">0x05</span>
                  <span class="field-desc">SOCKS5ç‰ˆæœ¬</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">1</span>
                  <span class="field-name">CMD</span>
                  <span class="field-value">0x01</span>
                  <span class="field-desc">CONNECTå‘½ä»¤</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">2</span>
                  <span class="field-name">RSV</span>
                  <span class="field-value">0x00</span>
                  <span class="field-desc">ä¿ç•™å­—æ®µ</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">3</span>
                  <span class="field-name">ATYP</span>
                  <span class="field-value">0x03</span>
                  <span class="field-desc">åŸŸåç±»å‹</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">4</span>
                  <span class="field-name">LEN</span>
                  <span class="field-value">0x{{ config.target.length.toString(16).toUpperCase() }}</span>
                  <span class="field-desc">åŸŸåé•¿åº¦</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">5</span>
                  <span class="field-name">DST.ADDR</span>
                  <span class="field-value">{{ config.target }}</span>
                  <span class="field-desc">ç›®æ ‡åŸŸå</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">5+LEN</span>
                  <span class="field-name">DST.PORT</span>
                  <span class="field-value">0x{{ config.targetPort.toString(16).toUpperCase() }}</span>
                  <span class="field-desc">ç›®æ ‡ç«¯å£</span>
                </div>
              </div>
            </div>
          </li>

          <!-- æ­¥éª¤4ï¼šå“åº” -->
          <li
            class="protocol-step"
            :class="getStepClass(3)"
          >
            <h3>æ­¥éª¤ 4: è¿æ¥å“åº” (Response)</h3>
            <p>æœåŠ¡å™¨è¿”å›è¿æ¥ç»“æœï¼ŒæˆåŠŸåå¼€å§‹åŒå‘è½¬å‘æ•°æ®ã€‚</p>

            <div v-if="currentStep >= 3 && testSuccess" class="packet">
              <div class="packet-header">âœ… æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ï¼šè¿æ¥æˆåŠŸ</div>
              <div class="packet-data">05 00 00 01 7F 00 00 01 1F 90</div>
              <div class="packet-fields">
                <div class="packet-field">
                  <span class="field-offset">0</span>
                  <span class="field-name">VER</span>
                  <span class="field-value">0x05</span>
                  <span class="field-desc">SOCKS5ç‰ˆæœ¬</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">1</span>
                  <span class="field-name">REP</span>
                  <span class="field-value">0x00</span>
                  <span class="field-desc">æˆåŠŸ</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">3</span>
                  <span class="field-name">ATYP</span>
                  <span class="field-value">0x01</span>
                  <span class="field-desc">IPv4åœ°å€</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">4-7</span>
                  <span class="field-name">BND.ADDR</span>
                  <span class="field-value">127.0.0.1</span>
                  <span class="field-desc">ç»‘å®šåœ°å€</span>
                </div>
                <div class="packet-field">
                  <span class="field-offset">8-9</span>
                  <span class="field-name">BND.PORT</span>
                  <span class="field-value">8080</span>
                  <span class="field-desc">ç»‘å®šç«¯å£</span>
                </div>
              </div>
            </div>

            <div v-if="currentStep >= 3 && !testSuccess" class="packet" style="background: #ffebee;">
              <div class="packet-header" style="color: #f56565;">âŒ è¿æ¥å¤±è´¥</div>
              <div class="packet-data">05 05 00 01 00 00 00 00 00 00</div>
              <div class="packet-fields">
                <div class="packet-field">
                  <span class="field-offset">1</span>
                  <span class="field-name">REP</span>
                  <span class="field-value">0x05</span>
                  <span class="field-desc">è¿æ¥è¢«æ‹’ç»</span>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>

    <!-- Wiresharkä½¿ç”¨è¯´æ˜ -->
    <div class="wireshark-tip">
      <h3>ğŸ”§ WiresharkæŠ“åŒ…åˆ†ææŒ‡å—</h3>
      <ol>
        <li>ä¸‹è½½å¹¶å®‰è£… <strong>Wireshark</strong>: <a href="https://www.wireshark.org/download.html" target="_blank" style="color: #2196f3;">https://www.wireshark.org/</a></li>
        <li>å¯åŠ¨Wiresharkï¼Œé€‰æ‹©ç½‘ç»œæ¥å£ï¼ˆå»ºè®®é€‰æ‹©æ­£åœ¨ä½¿ç”¨çš„ç½‘å¡æˆ–Loopbackæ¥å£ï¼‰</li>
        <li>è®¾ç½®æŠ“åŒ…è¿‡æ»¤å™¨ï¼š<code>tcp.port == 1080</code>ï¼ˆå‡è®¾SOCKS5æœåŠ¡å™¨ç›‘å¬1080ç«¯å£ï¼‰</li>
        <li>ç‚¹å‡»"å¼€å§‹æŠ“åŒ…"ï¼ˆè“è‰²é²¨é±¼é³å›¾æ ‡ï¼‰</li>
        <li>åœ¨æœ¬é¡µé¢ç‚¹å‡»"å¼€å§‹æµ‹è¯•è¿æ¥"æŒ‰é’®ï¼Œè§¦å‘SOCKS5è¿æ¥</li>
        <li>åœ¨Wiresharkä¸­æŸ¥çœ‹æŠ“åˆ°çš„æ•°æ®åŒ…ï¼Œä¼šçœ‹åˆ°å®Œæ•´çš„SOCKS5åè®®äº¤äº’è¿‡ç¨‹</li>
        <li>å³é”®ç‚¹å‡»æ•°æ®åŒ… â†’ "Follow" â†’ "TCP Stream" æŸ¥çœ‹å®Œæ•´çš„TCPå¯¹è¯</li>
        <li>å¯¹æ¯”WiresharkæŠ“åˆ°çš„å®é™…æ•°æ®åŒ…å’Œæœ¬é¡µé¢æ˜¾ç¤ºçš„ç†è®ºæ•°æ®åŒ…ï¼ŒåŠ æ·±ç†è§£</li>
      </ol>
    </div>
  </div>

  <!-- å¼•å…¥Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- ä¸»åº”ç”¨ä»£ç  -->
  <script src="./app.js"></script>
</body>
</html>
